{% extends "layout.full.twig" %}

{% block title %}{% if mode == "defense" %}{{ LNG.lm_defenses }}{% else %}{{ LNG.lm_shipshard }}{% endif %}{% endblock %}
{% block content %}

<div class="content_page">
	<div class="sci-card__header">
		<h2 class="sci-card__title">
			{% if mode == "defense" %}
				<i class="fas fa-shield-alt"></i> {{ LNG.lm_defenses }}
			{% else %}
				<i class="fas fa-rocket"></i> {{ LNG.lm_shipshard }}
			{% endif %}
		</h2>
	</div>

	{% if not NotBuilding %}
	<div class="infobox">
		<i class="fas fa-exclamation-triangle"></i> {{ LNG.bd_building_shipyard }}
	</div>
	{% endif %}

	{% if BuildList %}
	<div class="sci-card sci-card--elevated sci-mb-lg">
		<h3 class="sci-text-cyan sci-mb-md">
			<i class="fas fa-tasks"></i> {{ LNG.bd_production_queue }}
		</h3>
		<div class="sci-card__body">
			<div class="sci-progress sci-mb-md">
				<div id="bx" class="sci-progress__bar"></div>
				<div class="sci-progress__text">
					<i class="fas fa-clock"></i> <span id="timeleft"></span>
				</div>
			</div>
			
			<form action="game.php?page=shipyard&amp;mode={{ mode }}" method="post">
				<input type="hidden" name="action" value="delete">
				<div class="sci-card" style="padding: var(--spacing-md); background: rgba(239, 68, 68, 0.1); border: 1px solid var(--color-accent-red);">
					<h4 class="sci-text-red sci-mb-md">
						<i class="fas fa-exclamation-circle"></i> {{ LNG.bd_cancel_warning }}
					</h4>
					<select style="width: 100%; min-height: 200px; margin-bottom: var(--spacing-md);" 
							name="auftr[]" id="auftr" size="10" multiple>
						<option> </option>
					</select>
					<button type="submit" class="sci-btn sci-btn--danger" style="width: 100%;">
						<i class="fas fa-times"></i> {{ LNG.bd_cancel_send }}
					</button>
				</div>
			</form>
		</div>
	</div>
	{% endif %}

	<form action="game.php?page=shipyard&amp;mode={{ mode }}" method="post">
		<div class="sci-grid sci-grid--2">
			{% for ID, Element in elementList %}
			<div class="sci-card sci-mb-md">
				<div class="sci-card__header">
					<div class="sci-flex sci-gap-md" style="flex: 1;">
						<img src="{{ dpath }}gebaeude/{{ ID }}.gif" alt="{{ LNG.tech[ID] }}" width="50" height="50" 
							 style="border-radius: var(--radius-md); border: 2px solid {% if mode == 'defense' %}var(--color-accent-orange){% else %}var(--color-accent-green){% endif %}; 
									box-shadow: 0 0 15px {% if mode == 'defense' %}rgba(247, 115, 22, 0.5){% else %}rgba(16, 185, 129, 0.5){% endif %};">
						<div style="flex: 1;">
							<h3 class="sci-card__title" style="margin: 0;">
								<a href="#" onclick="return Dialog.info({{ ID }})" class="sci-text-cyan">{{ LNG.tech[ID] }}</a>
							</h3>
							<span id="val_{{ ID }}">
								{% if Element.available != 0 %}
								<span class="sci-badge sci-badge--green sci-mt-xs">
									{{ LNG.bd_available }}: {{ Element.available|number_format }}
								</span>
								{% endif %}
							</span>
						</div>
					</div>
				</div>
				
				<div class="sci-card__body">
					<div class="sci-grid sci-grid--2 sci-mb-md">
						<div>
							<h4 class="sci-text-secondary" style="font-size: 0.875rem; margin-bottom: var(--spacing-sm);">
								<i class="fas fa-coins"></i> {{ LNG.bd_needed_resources }}
							</h4>
							{% for RessID, RessAmount in Element.costResources %}
							<div class="sci-flex sci-gap-sm sci-mb-sm" style="align-items: center;">
								<img src="{{ dpath }}images/{{ RessID }}.gif" alt="" width="28" height="28" 
									 style="border-radius: var(--radius-sm); box-shadow: 0 0 8px rgba(0, 243, 255, 0.3);">
								<span class="{% if Element.costOverflow[RessID] == 0 %}sci-text-green{% else %}sci-text-red{% endif %} resource-value" 
									  style="font-size: 1rem;">
									{{ RessAmount|number_format }}
								</span>
							</div>
							{% endfor %}
						</div>

						<div>
							<div class="sci-flex sci-gap-sm sci-mb-md" style="align-items: center; padding: var(--spacing-md); 
								 background: {% if mode == 'defense' %}rgba(247, 115, 22, 0.1){% else %}rgba(16, 185, 129, 0.1){% endif %}; 
								 border-radius: var(--radius-md); 
								 border: 1px solid {% if mode == 'defense' %}var(--color-accent-orange){% else %}var(--color-accent-green){% endif %};">
								<i class="fas fa-clock {% if mode == 'defense' %}sci-text-orange{% else %}sci-text-green{% endif %}" style="font-size: 1.25rem;"></i>
								<div>
									<div class="sci-text-muted" style="font-size: 0.75rem;">{{ LNG.bd_build_time }}</div>
									<span class="sci-text-yellow" style="font-weight: 600; font-size: 1.125rem;">{{ Element.elementTime|time }}</span>
								</div>
							</div>
							
							<div class="sci-badge sci-badge--cyan" style="width: 100%; padding: var(--spacing-sm); text-align: center;">
								<i class="fas fa-calculator"></i> {{ LNG.bd_max_ships_long }}: 
								<strong>{{ Element.maxBuildable|number_format }}</strong>
							</div>
						</div>
					</div>

					<div>
						{% if Element.AlreadyBuild %}
							<div class="sci-badge sci-badge--red" style="width: 100%; padding: var(--spacing-md); text-align: center;">
								<i class="fas fa-ban"></i> {{ LNG.bd_protection_shield_only_one }}
							</div>
						{% elseif NotBuilding and Element.buyable %}
							<div class="sci-flex sci-gap-sm sci-mb-md">
								<input style="flex: 1;" type="number" name="fmenge[{{ ID }}]" id="input_{{ ID }}" value="0" 
									   min="0" max="{{ Element.maxBuildable }}" tabindex="{{ loop.index }}"
									   placeholder="{{ LNG.bd_quantity }}">
								<button type="button" class="sci-btn sci-btn--primary" 
										onclick="$('#input_{{ ID }}').val('{{ Element.maxBuildable }}')">
									<i class="fas fa-sort-amount-up"></i> {{ LNG.bd_max_ships }}
								</button>
							</div>
						{% else %}
							<div class="sci-badge sci-badge--red" style="width: 100%; padding: var(--spacing-md); text-align: center;">
								<i class="fas fa-exclamation-triangle"></i> {{ LNG.bd_not_possible }}
							</div>
						{% endif %}
					</div>
				</div>
			</div>
			{% endfor %}
		</div>
		
		{% if NotBuilding %}
		<div class="sci-text-center sci-mt-lg">
			<button type="submit" class="sci-btn sci-btn--primary" style="min-width: 300px; padding: var(--spacing-md) var(--spacing-xl);">
				{% if mode == "defense" %}
					<i class="fas fa-hammer"></i> {{ LNG.bd_build_defenses }}
				{% else %}
					<i class="fas fa-hammer"></i> {{ LNG.bd_build_ships }}
				{% endif %}
			</button>
		</div>
		{% endif %}
	</form>
</div>

{% endblock %}
{% block script %}
<script type="text/javascript">
data			= {{ BuildList|json_encode }};
bd_operating	= '{{ LNG.bd_operating }}';
bd_available	= '{{ LNG.bd_available }}';
</script>
{% if BuildList %}
<script src="scripts/base/bcmath.js"></script>
<script src="scripts/game/shipyard.js"></script>
<script type="text/javascript">
$(function() {
    ShipyardInit();
});
</script>
{% endif %}
{% endblock %}
